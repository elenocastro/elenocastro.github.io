<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<title>Eleno Castro | Como crear un gráfico de mapa en Python</title>
<meta name="description" content='Un tutorial para principiantes en Python en el manejo y visulización de datos.'>

<!-- Bootstrap & MDB -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.17.0/css/mdb.min.css" integrity="sha256-/SwJ2GDcEt5382i8zqDwl36VJGECxEoIcBIuoLmLR4g=" crossorigin="anonymous" />

<!-- Fonts & Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css"  integrity="sha256-h20CPZ0QyXlBuAw7A+KluUYx/3pK+c7lYEpqLTlxjYQ=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display+SC:wght@900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&display=swap" rel="stylesheet">


<!-- Styles -->
<link rel="shortcut icon" href="/assets/img/favicon.ico">
<link rel="stylesheet" href="/assets/css/main.css">

<link rel="canonical" href="/blog/2020/Como-hacer-un-mapa-con-python/">

<!-- Open Graph -->

<meta property="og:site_name" content="Eleno is a salvadoran economist, currently a Economics PhD Student at The Johns Hopkins University." />
<meta property="og:type" content="object" />
<meta property="og:title" content='Eleno Castro | Como crear un gráfico de mapa en Python' />
<meta property="og:url" content="/blog/2020/Como-hacer-un-mapa-con-python/" />
<meta property="og:description" content="Un tutorial para principiantes en Python en el manejo y visulización de datos." />


<meta property="og:image" content="/assets/img/post_3/mapa_4.png" />




<!-- Twitter cards -->
<meta name="twitter:site" content="@elenocastro" />
<meta name="twitter:creator" content="@elenocastro" />
<meta name="twitter:title" content='Eleno Castro | Como crear un gráfico de mapa en Python' />


<meta name="twitter:description" content="Un tutorial para principiantes en Python en el manejo y visulización de datos." />



<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://www.elenocastro.com/assets/img/post_3/mapa_4.png" /></meta>

<!-- end of Twitter cards -->

    <script src="/assets/js/distillpub/template.v2.js"></script>
    <script src="/assets/js/distillpub/transforms.v2.js"></script>
    

    <script type='text/javascript' src='https://platform-api.sharethis.com/js/sharethis.js#property=5f1285fa133eda00126e4805&product=sticky-share-buttons&cms=sop' async='async'></script>

  </head>

  <d-front-matter>
    <script type="text/json">{
      "title": "Como crear un gráfico de mapa en Python",
      "description": "Un tutorial para principiantes en Python en el manejo y visulización de datos.",
      "published": "July 4, 2020",
      "authors": [
        
        {
          "author": "Eleno Castro",
          "authorURL": "https://twitter.com/ElenoCastro",
          "affiliations": [
            {
              "name": "",
              "url": ""
            }
          ]
        }
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script>
  </d-front-matter>

  <body class="fixed-top-nav ">

    <!-- Header -->

    <header>

    <!-- Nav Bar -->
    <nav id="navbar" class="navbar navbar-light bg-white navbar-expand-sm fixed-top">
    <div class="container">
      
        
        <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Eleno</span> Castro</a>
      
      <!-- Navbar Toogle -->
      <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar top-bar"></span>
        <span class="icon-bar middle-bar"></span>
        <span class="icon-bar bottom-bar"></span>
      </button>
      <div class="collapse navbar-collapse text-right" id="navbarNav">
        <ul class="navbar-nav ml-auto flex-nowrap">
          <!-- About -->
          <li class="nav-item ">
            <a class="nav-link" href="/">
              about
              
            </a>
          </li>
          
          <!-- Blog -->
          <li class="nav-item active">
            <a class="nav-link" href="/blog/">
              blog
              
            </a>
          </li>
          
          <!-- Other pages -->
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/curriculum/">
                curriculum
                
              </a>
          </li>
          
          
          
          <li class="nav-item ">
              <a class="nav-link" href="/publications/">
                publications
                
              </a>
          </li>
          
          
        </ul>
      </div>
    </div>
  </nav>

</header>


    <!-- Content -->

    <div class="post distill">
      <div class="text-center">
        <d-title>
          <h1 style="font-family: 'Playfair Display SC', serif">Como crear un gráfico de mapa en Python</h1>
          <p style = "font-style: italic">Un tutorial para principiantes en Python en el manejo y visulización de datos.</p>
        </d-title>
      </div>

      <d-byline></d-byline>

      <d-article>
        <p class="first-p"><span class="first-word">P</span> ython es un lenguaje muy versatil que permite manejar datos y hacer visualizaciones de todo tipo. Si eres nuevo te recomiendo descargar el paquete de <a href="https://www.anaconda.com/products/individual" target="blank">Anaconda</a> y utilizar Jupyter como procesador de texto para ir viendo las gráficas a medida vas escribiendo el código.</p>

<h2 id="preparando-las-librerías-y-las-datos-a-utilizar">Preparando las librerías y las datos a utilizar</h2>
<p>Primero importaremos las librerías que necesitamos para trabajar la información. Utilizaremos Pandas que es una librería para manejar datos, especialmente dataframes y series. Esta librería viene integrada con Anaconda.
La segunda librería que utilizaremos es Geopandas, esta nos permite trabajar archivos llamados shapefile, que contienen las formas y georeferencias que se utilizaremos para graficar los mapas. La ventaja de Geopandas que integra las funciones de Pandas.</p>

<d-code block="" language="python">
  import pandas as pd
  import geopandas as gpd
</d-code>

<p>Usualmente esta librería no viene integrada al instalar Anaconda. Sin embargo, puede ser fácilmente instalada con tan solo correr en una celda de Jupyter el siguiente código:</p>

<d-code block="" language="python">
  ¡pip install geopandas
</d-code>

<p>Descargaremos el <a href="https://www.cnr.gob.sv/geoportal/LIMITES_WGS_84_.zip" target="blank">shapefile (el mapa)</a>  de la página oficial del gobierno de El Salvador que contiene los limites políticos de los municipios . Para este ejercicio podemos usar tanto el archivo Lambert o WGS.
Abriremos el archivo en Jupyter:</p>

<d-code block="" language="python">
  shapefile = gpd.read_file(direccion+'\LIM_MUNICIPAL.shp')
  shapefile.head(5)
</d-code>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/post_3/tabla_shapefile.png" />
    </div>
</div>

<p>Abriremos luego los datos para colorear el mapa, para este ejemplo he descargado el número de accidentes viales por municipio de esta página web: <a href="http://transparencia.pnc.gob.sv/" target="blank">Portal de Transparencia de la Policía Nacional Civil</a> .</p>

<d-code block="" language="python">
  acc_auto = pd.read_csv(direccion+r'\accidentes_auto.csv',encoding='utf-8')
  acc_auto.head(5)
</d-code>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/post_3/tabla_acc_auto.png" />
    </div>
</div>

<p>Luego se debe unir la información a través de un <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.merge.html">merge</a>. Al observar la información notamos que las llaves será el nombre del municipio (parte importante sería preparar la información para asegurarnos que los municipios tienen los mismos nombres, en el ejercicio asumiremos que sí).</p>

<d-code block="" language="python">
  acc_auto = acc_auto[acc_auto['Año']==2019]
  shapefile = shapefile.merge(
                       right = acc_auto,
                       left_on = 'NA2',
                       right_on = 'Municipio',
                       how = 'left'
                       )
</d-code>

<hr />
<h2 id="utilizando-geopandas">Utilizando Geopandas</h2>
<p>Usar Geopandas es sumamente fácil y está bastante bien integrado con <a href="https://matplotlib.org/">Matplotlib</a>. Necesitamos para hacer un simple mapa escribir .plot(column = ‘variable’).</p>

<d-code block="" language="python">
  shapefile.plot(column = 'CHOQUE')
</d-code>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/post_3/mapa_simple_1.png" />
    </div>
</div>

<h3 id="añadiendo-legenda">Añadiendo legenda</h3>
<p>Podemos continuar añadir atributos al mapa para que se vea mejor como una legenda horizontal y con una barra de color de distintos niveles de Naranjas (‘Oranges’).</p>

<d-code block="" language="python">
  shapefile.plot(
              column = 'CHOQUE', 
              legend = True, 
              legend_kwds = {
                'label': "Número de choques de vehiculos",
                'orientation': "horizontal"
                },
              cmap = 'Oranges'
              )
</d-code>

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/post_3/mapa_simple_2.png" />
    </div>
</div>

<p>Debido a que gran parte de los choques se concentran en algunas zonas específicas los colores más intensos se encuentran en unos pocos municipios mientras no se logra ver diferencia en el resto. Una idea para cambiar esto, es recodificar la variable como su logaritmo.</p>

<d-code block="" language="python">
  import numpy as np

  shapefile['CHOQUE'] = shapefile['CHOQUE'].fillna(1)
  shapefile['CHOQUE_log'] = np.log10(shapefile['CHOQUE'])

  #replazando valores inf, -inf resultados de log(0)
  shapefile['CHOQUE_log'] = shapefile['CHOQUE_log'].replace([np.inf,-np.inf],0)

</d-code>

<p><br />
Al correr nuevamente nuestro código anterior tendríamos un gráfico como el siguiente:</p>

<d-code block="" language="python">
  shapefile.plot(
              column = 'CHOQUE_log', 
              legend = True, 
              legend_kwds = {
                'label': "Número de choques de vehiculos",
                'orientation': "horizontal"
                },
              cmap = 'Oranges'
              )
</d-code>
<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/post_3/mapa_simple_2_log.png" />
    </div>
</div>

<h3 id="utilizando-matplotlib">Utilizando matplotlib</h3>

<p>Para mejorar muchas de las características del mapa se puede usar matplotlib. Esto nos permitirá ajustar mejor la barra de color, el tamaño del mapa, modificar ejes, entre otras cosas.</p>

<p>Si continuamos con el ejemplo, matplotlib nos permite ajustar la barra de color para que la legenda muestre una escala logarítmica.</p>

<d-code block="" language="python">
import matplotlib.pyplot as plt
import matplotlib.colors as mplc
import matplotlib.ticker as ticker


#creando una figura en matplotlib y ajustando el tamaño deseado 
fig , ax = plt.subplots(1 ,figsize = (14,8))



shapefile.plot(
  column = 'CHOQUE', 
  legend = False, 
  cmap ='Oranges',
  ax = ax,
  norm = mplc.LogNorm(), #utilizando el logaritmo de la variable
  linewidth = 1, #ajustando el grosor de las lineas del mapa
  edgecolor ='black' #color de las lineas del mapa
  )


vmin = shapefile.CHOQUE.min()
vmax = shapefile.CHOQUE.max()

#agregando barra de color atraves de matplotlib

#ajsutando posición y dimensiones de la barra
cax = fig.add_axes([0.9, 0.2, 0.01, 0.6]) 
#atributos de la barra de color
sm = plt.cm.ScalarMappable(
                      cmap = 'Oranges', 
                      norm = mplc.LogNorm(vmin = vmin, vmax = vmax)
                      )
sm._A = []

#OPCIONAL
#formateando los números a absultos de lo contrario salieran a base 10 
formatter = ticker.LogFormatter(10, labelOnlyBase=False) 
cbr = fig.colorbar(
                  sm, 
                  cax = cax, 
                  format = formatter,
                  ticks = [1,10,100]
                  )

ax.set_title('Número de choques en El Salvador', fontsize = 25)

cbr.ax.tick_params(labelsize = 15) #tamaño de letra de las legendas

ax.axis('off') #desactivando los ejes de posicionamiento

plt.show()
</d-code>
<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/post_3/mapa_3.png" />
    </div>
</div>

<h3 id="generando-un-mapa-con-variables-categóricas">Generando un mapa con variables categóricas</h3>

<p>En algunos casos nos interesaría colorear el mapa con valores categóricos. Para ello, dividiremos nuestra variable ‘CHOQUE’ en cuartiles a través de <a href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.cut.html#:~:text=Use%20cut%20when%20you%20need,pre%2Dspecified%20array%20of%20bins.">pandas.cut</a>:</p>

<d-code block="" language="python">
labels = ['Cuartil_1', 'Cuartil_2','Cuartil_3','Cuartil_4']

#creando columna con variables categoricas a partir de 'CHOQUE'
shapefile['CHOQUE_Cuartiles'] = pd.cut(
                        x = shapefile['CHOQUE_log'],
                        bins = 4, 
                        labels = labels
                        )


#utilizando matplotlib nuevamente
fig , ax = plt.subplots(1, figsize = (14,8))

#definiendo caracteristicas del mapa (categorical = True)
shapefile.plot(
  column = 'CHOQUE_Cuartiles', 
  categorical = True, 
  legend = True,
  cmap = 'Oranges',
  ax = ax,
  linewidth = 1,
  edgecolor = 'black',
  )



ax.axis('off')


fig.show()

</d-code>
<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        <img class="img-fluid rounded z-depth-1" src="/assets/img/post_3/mapa_4.png" />
    </div>
</div>

        <d-byline></d-byline>
        <!-- ShareThis BEGIN Follow icon -->
        <div class="sharethis-inline-follow-buttons"></div>
        <!-- ShareThis END -->
      </d-article>

      <d-appendix>
        <d-footnote-list></d-footnote-list>
        <d-citation-list></d-citation-list>
      </d-appendix>

    </div>

    <!-- Footer -->

    
<footer class="fixed-bottom">
  <div class="container mt-0">
    &copy; Copyright 2025 Eleno Castro.
    
    
  </div>
</footer>



  </body>

  <!-- Load Core and Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.4.0/umd/popper.min.js" integrity="sha256-OH05DFHUWzr725HmuHo3pnuvUUn+TJuj8/Qz9xytFEw=" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.17.0/js/mdb.min.js"  integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

<!-- Load Common JS -->
<script src="/assets/js/common.js"></script>

<!-- Code Syntax Highlighting -->
<link rel="stylesheet" href="https://gitcdn.link/repo/jwarby/jekyll-pygments-themes/master/github.css" />


<!-- Load KaTeX -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" integrity="sha256-V8SV2MO1FUb63Bwht5Wx9x6PVHNa02gv8BgH/uH3ung=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.js" integrity="sha256-F/Xda58SPdcUCr+xhSGz9MA2zQBPb0ASEYKohl8UCHc=" crossorigin="anonymous"></script>
<script src="/assets/js/katex.js"></script>



<!-- Load Mansory & imagesLoaded -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/masonry/4.2.2/masonry.pkgd.min.js" integrity="" crossorigin="anonymous"></script>
<script src="https://unpkg.com/imagesloaded@4/imagesloaded.pkgd.min.js"></script>

<!-- Project Cards Layout -->
<script type="text/javascript">
  // Init Masonry
  var $grid = $('.grid').masonry({
    gutter: 10,
    horizontalOrder: true,
    itemSelector: '.grid-item',
  });
  // layout Masonry after each image loads
  $grid.imagesLoaded().progress( function() {
    $grid.masonry('layout');
  });
</script>





<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-171633738-1', 'auto');
ga('send', 'pageview');
</script>



  <d-bibliography src="/assets/bibliography/">
  </d-bibliography>

    <!-- read_more options -->
    

<!--Buttom to spanish-->

  <d-article>
    <h2 class="post-title" style="font-family: 'Playfair Display', serif; text-align: center">Continua leyendo</h2>
    <div class="content-box clearfix">
      
      
      <article class="post_index">
        
          <a class="post-thumbnail" style="background-image: url(/assets/img/blog_tutorias.png)" href="/blog/2023/Recuperar-los-aprendizajes/"></a>
        
        <div class="post-content">
          <h3 class="post-title" style="font-family: 'Playfair Display', serif; text-align: left"><a  href="/blog/2023/Recuperar-los-aprendizajes/" style=" text-decoration: none;">Recuperar los aprendizajes ¡se puede!: tutorías remotas en El Salvador</a></h3>
          <p class="post-meta">July 27, 2023&nbsp;&nbsp;&nbsp;&nbsp;</p>
        </div>
      </article>
      
      <article class="post_index">
        
          <a class="post-thumbnail" style="background-image: url(/assets/img/blog_vox_1.jpg)" href="/blog/2020/Bono-o-Factura-demografica/"></a>
        
        <div class="post-content">
          <h3 class="post-title" style="font-family: 'Playfair Display', serif; text-align: left"><a  href="/blog/2020/Bono-o-Factura-demografica/" style=" text-decoration: none;">¿Bono o factura demográfica? La pandemia pone en riesgo la promesa de la juventud en Mesoamérica</a></h3>
          <p class="post-meta">November 18, 2020&nbsp;&nbsp;&nbsp;&nbsp;</p>
        </div>
      </article>
      
      <article class="post_index">
        
          <a class="post-thumbnail" style="background-image: url(/assets/img/post_educacion_pandemia/Pandemia_educacion.jpg)" href="/blog/2020/Coronavirus-y-Educacion-4-cosas-que-deberias-saber/"></a>
        
        <div class="post-content">
          <h3 class="post-title" style="font-family: 'Playfair Display', serif; text-align: left"><a  href="/blog/2020/Coronavirus-y-Educacion-4-cosas-que-deberias-saber/" style=" text-decoration: none;">Coronavirus y Educación: 4 cosas que deberías saber</a></h3>
          <p class="post-meta">November 15, 2020&nbsp;&nbsp;&nbsp;&nbsp;</p>
        </div>
      </article>
      
    </div>
  </d-article>



  <body class="fixed-top-nav ">
    <d-article>
      
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          var disqus_shortname  = 'https-elenocastro-github-io';
          var disqus_identifier = '/blog/2020/Como-hacer-un-mapa-con-python';
          var disqus_title      = "Como crear un gráfico de mapa en Python";
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      
    </d-article>
  </body>
</html>
